import{c as de}from"./_commonjsHelpers.4e997714.js";var K={exports:{}};const ue=e=>typeof crypto!="undefined"&&typeof crypto.getRandomValues=="function"?()=>{const t=crypto.getRandomValues(new Uint8Array(1))[0];return(t>=e?t%e:t).toString(e)}:()=>Math.floor(Math.random()*e).toString(e),ne=(e=7,t=!1)=>Array.from({length:e},ue(t?16:36)).join("");K.exports=ne;K.exports.default=ne;var q=K.exports,Ae=()=>`uid::${q(7)}`,fe=(e,t=["endpointName","fingerprint"])=>typeof e=="object"&&e!==null&&t.every(r=>r in e),pe=e=>{try{const t=JSON.parse(e);return fe(t)?t:null}catch{return null}},xe=()=>{let e=[];return{add:(...t)=>{e=[...e,...t]},remove:t=>{e=typeof t=="string"?e.filter(r=>r.message.transactionId!==t):e.filter(r=>!t.includes(r))},entries:()=>e}},j=class{static toBackground(e,t){return e.postMessage(t)}static toExtensionContext(e,t){return e.postMessage(t)}},he=Object.defineProperty,be=Object.defineProperties,we=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,ye=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable,re=(e,t,r)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,C=(e,t)=>{for(var r in t||(t={}))ye.call(t,r)&&re(e,r,t[r]);if(ee)for(var r of ee(t))ve.call(t,r)&&re(e,r,t[r]);return e},X=(e,t)=>be(e,we(t)),_e=/^((?:background$)|devtools|popup|options|content-script|window)(?:@(\d+)(?:\.(\d+))?)?$/,Y=e=>{const[,t,r,g]=e.match(_e)||[];return{context:t,tabId:+r,frameId:g?+g:void 0}},W=({context:e,tabId:t,frameId:r})=>["background","popup","options"].includes(e)?e:`${e}@${t}${r?`.${r}`:""}`;const Ee=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],Z=Symbol(".toJSON was called"),ke=e=>{e[Z]=!0;const t=e.toJSON();return delete e[Z],t},se=({from:e,seen:t,to_:r,forceEnumerable:g,maxDepth:c,depth:s})=>{const n=r||(Array.isArray(e)?[]:{});if(t.push(e),s>=c)return n;if(typeof e.toJSON=="function"&&e[Z]!==!0)return ke(e);for(const[o,m]of Object.entries(e)){if(typeof Buffer=="function"&&Buffer.isBuffer(m)){n[o]="[object Buffer]";continue}if(m!==null&&typeof m=="object"&&typeof m.pipe=="function"){n[o]="[object Stream]";continue}if(typeof m!="function"){if(!m||typeof m!="object"){n[o]=m;continue}if(!t.includes(e[o])){s++,n[o]=se({from:e[o],seen:[...t],forceEnumerable:g,maxDepth:c,depth:s});continue}n[o]="[Circular]"}}for(const{property:o,enumerable:m}of Ee)typeof e[o]=="string"&&Object.defineProperty(n,o,{value:e[o],enumerable:g?!0:m,configurable:!0,writable:!0});return n};function Se(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=t;return typeof e=="object"&&e!==null?se({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}let oe=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach(r=>r(...t))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter(r=>r!==t)}});var Ie=(e,t,r)=>{const g=q(),c=new Map,s=new Map,n=o=>{if(o.destination.context===e&&!o.destination.frameId&&!o.destination.tabId){r==null||r(o);const{transactionId:m,messageID:x,messageType:A}=o,_=()=>{const b=c.get(m);if(b){const{err:f,data:S}=o;if(f){const w=f,$=self[w.name],D=new(typeof $=="function"?$:Error)(w.message);for(const R in w)D[R]=w[R];b.reject(D)}else b.resolve(S);c.delete(m)}},T=async()=>{let b,f,S=!1;try{const w=s.get(x);if(typeof w=="function")b=await w({sender:o.origin,id:x,data:o.data,timestamp:o.timestamp});else throw S=!0,new Error(`[webext-bridge] No handler registered in '${e}' to accept messages with id '${x}'`)}catch(w){f=w}finally{if(f&&(o.err=Se(f)),n(X(C({},o),{messageType:"reply",data:b,origin:{context:e,tabId:null},destination:o.origin,hops:[]})),f&&!S)throw b}};switch(A){case"reply":return _();case"message":return T()}}return o.hops.push(`${e}::${g}`),t(o)};return{handleMessage:n,endTransaction:o=>{const m=c.get(o);m==null||m.reject("Transaction was ended before it could complete"),c.delete(o)},sendMessage:(o,m,x="background")=>{const A=typeof x=="string"?Y(x):x,_="Bridge#sendMessage ->";if(!A.context)throw new TypeError(`${_} Destination must be any one of known destinations`);return new Promise((T,b)=>{const f={messageID:o,data:m,destination:A,messageType:"message",transactionId:q(),origin:{context:e,tabId:null},hops:[],timestamp:Date.now()};c.set(f.transactionId,{resolve:T,reject:b});try{n(f)}catch(S){c.delete(f.transactionId),b(S)}})},onMessage:(o,m)=>(s.set(o,m),()=>s.delete(o))}},O=class{constructor(e,t){this.endpointRuntime=e,this.streamInfo=t,this.emitter=oe(),this.isClosed=!1,this.handleStreamClose=()=>{this.isClosed||(this.isClosed=!0,this.emitter.emit("closed",!0),this.emitter.events={})},O.initDone||(e.onMessage("__crx_bridge_stream_transfer__",r=>{const{streamId:g,streamTransfer:c,action:s}=r.data,n=O.openStreams.get(g);n&&!n.isClosed&&(s==="transfer"&&n.emitter.emit("message",c),s==="close"&&(O.openStreams.delete(g),n.handleStreamClose()))}),O.initDone=!0),O.openStreams.set(this.streamInfo.streamId,this)}get info(){return this.streamInfo}send(e){if(this.isClosed)throw new Error("Attempting to send a message over closed stream. Use stream.onClose(<callback>) to keep an eye on stream status");this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:e,action:"transfer"},this.streamInfo.endpoint)}close(e){e&&this.send(e),this.handleStreamClose(),this.endpointRuntime.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.streamInfo.streamId,streamTransfer:null,action:"close"},this.streamInfo.endpoint)}onMessage(e){return this.getDisposable("message",e)}onClose(e){return this.getDisposable("closed",e)}getDisposable(e,t){const r=this.emitter.on(e,t);return Object.assign(r,{dispose:r,close:r})}},z=O;z.initDone=!1;z.openStreams=new Map;var Te=e=>{const t=new Map,r=new Map,g=oe();e.onMessage("__crx_bridge_stream_open__",n=>new Promise(o=>{const{sender:m,data:x}=n,{channel:A}=x;let _=!1,T=()=>{};const b=()=>{const f=r.get(A);typeof f=="function"?(f(new z(e,X(C({},x),{endpoint:m}))),_&&T(),o(!0)):_||(_=!0,T=g.on("did-change-stream-callbacks",b))};b()}));async function c(n,o){if(t.has(n))throw new Error("webext-bridge: A Stream is already open at this channel");const m=typeof o=="string"?Y(o):o,x={streamId:q(),channel:n,endpoint:m},A=new z(e,x);return A.onClose(()=>t.delete(n)),await e.sendMessage("__crx_bridge_stream_open__",x,m),t.set(n,A),A}function s(n,o){if(r.has(n))throw new Error("webext-bridge: This channel has already been claimed. Stream allows only one-on-one communication");r.set(n,o),g.emit("did-change-stream-callbacks")}return{openStream:c,onOpenStreamChannel:s}},ae={exports:{}};(function(e,t){(function(r,g){g(e)})(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:de,function(r){if(typeof globalThis!="object"||typeof chrome!="object"||!chrome||!chrome.runtime||!chrome.runtime.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser=="undefined"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const g="The message port closed before a response was received.",c="Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)",s=n=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class m extends WeakMap{constructor(i,d=void 0){super(d),this.createItem=i}get(i){return this.has(i)||this.set(i,this.createItem(i)),super.get(i)}}const x=a=>a&&typeof a=="object"&&typeof a.then=="function",A=(a,i)=>(...d)=>{n.runtime.lastError?a.reject(new Error(n.runtime.lastError.message)):i.singleCallbackArg||d.length<=1&&i.singleCallbackArg!==!1?a.resolve(d[0]):a.resolve(d)},_=a=>a==1?"argument":"arguments",T=(a,i)=>function(u,...h){if(h.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${_(i.minArgs)} for ${a}(), got ${h.length}`);if(h.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${_(i.maxArgs)} for ${a}(), got ${h.length}`);return new Promise((y,E)=>{if(i.fallbackToNoCallback)try{u[a](...h,A({resolve:y,reject:E},i))}catch(l){console.warn(`${a} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,l),u[a](...h),i.fallbackToNoCallback=!1,i.noCallback=!0,y()}else i.noCallback?(u[a](...h),y()):u[a](...h,A({resolve:y,reject:E},i))})},b=(a,i,d)=>new Proxy(i,{apply(u,h,y){return d.call(h,a,...y)}});let f=Function.call.bind(Object.prototype.hasOwnProperty);const S=(a,i={},d={})=>{let u=Object.create(null),h={has(E,l){return l in a||l in u},get(E,l,k){if(l in u)return u[l];if(!(l in a))return;let p=a[l];if(typeof p=="function")if(typeof i[l]=="function")p=b(a,a[l],i[l]);else if(f(d,l)){let P=T(l,d[l]);p=b(a,a[l],P)}else p=p.bind(a);else if(typeof p=="object"&&p!==null&&(f(i,l)||f(d,l)))p=S(p,i[l],d[l]);else if(f(d,"*"))p=S(p,i[l],d["*"]);else return Object.defineProperty(u,l,{configurable:!0,enumerable:!0,get(){return a[l]},set(P){a[l]=P}}),p;return u[l]=p,p},set(E,l,k,p){return l in u?u[l]=k:a[l]=k,!0},defineProperty(E,l,k){return Reflect.defineProperty(u,l,k)},deleteProperty(E,l){return Reflect.deleteProperty(u,l)}},y=Object.create(a);return new Proxy(y,h)},w=a=>({addListener(i,d,...u){i.addListener(a.get(d),...u)},hasListener(i,d){return i.hasListener(a.get(d))},removeListener(i,d){i.removeListener(a.get(d))}}),$=new m(a=>typeof a!="function"?a:function(d){const u=S(d,{},{getContent:{minArgs:0,maxArgs:0}});a(u)});let D=!1;const R=new m(a=>typeof a!="function"?a:function(d,u,h){let y=!1,E,l=new Promise(F=>{E=function(I){D||(console.warn(c,new Error().stack),D=!0),y=!0,F(I)}}),k;try{k=a(d,u,E)}catch(F){k=Promise.reject(F)}const p=k!==!0&&x(k);if(k!==!0&&!p&&!y)return!1;const P=F=>{F.then(I=>{h(I)},I=>{let J;I&&(I instanceof Error||typeof I.message=="string")?J=I.message:J="An unexpected error occurred",h({__mozWebExtensionPolyfillReject__:!0,message:J})}).catch(I=>{console.error("Failed to send onMessage rejected reply",I)})};return P(p?k:l),!0}),le=({reject:a,resolve:i},d)=>{n.runtime.lastError?n.runtime.lastError.message===g?i():a(new Error(n.runtime.lastError.message)):d&&d.__mozWebExtensionPolyfillReject__?a(new Error(d.message)):i(d)},Q=(a,i,d,...u)=>{if(u.length<i.minArgs)throw new Error(`Expected at least ${i.minArgs} ${_(i.minArgs)} for ${a}(), got ${u.length}`);if(u.length>i.maxArgs)throw new Error(`Expected at most ${i.maxArgs} ${_(i.maxArgs)} for ${a}(), got ${u.length}`);return new Promise((h,y)=>{const E=le.bind(null,{resolve:h,reject:y});u.push(E),d.sendMessage(...u)})},me={devtools:{network:{onRequestFinished:w($)}},runtime:{onMessage:w(R),onMessageExternal:w(R),sendMessage:Q.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:Q.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},H={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":H},services:{"*":H},websites:{"*":H}},S(n,me,o)};r.exports=s(chrome)}else r.exports=globalThis.browser})})(ae);var Ce=ae.exports,L=xe(),v=new Map,N=new Map,G=new Map,ie=(e,t)=>(N.set(e,(N.get(e)||new Set).add(t)),()=>{const r=N.get(e);(r==null?void 0:r.delete(t))&&(r==null?void 0:r.size)===0&&N.delete(e)}),ge=(e,t)=>{G.set(e,(G.get(e)||new Set).add(t))},M=e=>({withFingerprint:t=>{const r=c=>({and:()=>c}),g={aboutIncomingMessage:c=>{const s=v.get(e);return j.toExtensionContext(s.port,{status:"incoming",message:c}),r(g)},aboutSuccessfulDelivery:c=>{const s=v.get(e);return j.toExtensionContext(s.port,{status:"delivered",receipt:c}),r(g)},aboutMessageUndeliverability:(c,s)=>{const n=v.get(e);return(n==null?void 0:n.fingerprint)===t&&j.toExtensionContext(n.port,{status:"undeliverable",resolvedDestination:c,message:s}),r(g)},whenDeliverableTo:c=>{const s=()=>{const n=v.get(e);if((n==null?void 0:n.fingerprint)===t&&v.has(c))return j.toExtensionContext(n.port,{status:"deliverable",deliverableTo:c}),!0};if(!s()){const n=ie(c,s);ge(t,n)}return r(g)},aboutSessionEnded:c=>{const s=v.get(e);return(s==null?void 0:s.fingerprint)===t&&j.toExtensionContext(s.port,{status:"terminated",fingerprint:c}),r(g)}};return g}}),Me=Ae(),V=Ie("background",e=>{var t;if(e.origin.context==="background"&&["content-script","devtools "].includes(e.destination.context)&&!e.destination.tabId)throw new TypeError("When sending messages from background page, use @tabId syntax to target specific tab");const r=W(C(C({},e.origin),e.origin.context==="window"&&{context:"content-script"})),g=W(X(C(C({},e.destination),e.destination.context==="window"&&{context:"content-script"}),{tabId:e.destination.tabId||e.origin.tabId}));e.destination.tabId=null,e.destination.frameId=null;const c=()=>v.get(g),s=()=>v.get(r),n=()=>{var o;M(g).withFingerprint(c().fingerprint).aboutIncomingMessage(e);const m={message:e,to:c().fingerprint,from:{endpointId:r,fingerprint:(o=s())==null?void 0:o.fingerprint}};e.messageType==="message"&&L.add(m),e.messageType==="reply"&&L.remove(e.messageID),s()&&M(r).withFingerprint(s().fingerprint).aboutSuccessfulDelivery(m)};(t=c())!=null&&t.port?n():e.messageType==="message"&&(e.origin.context==="background"?ie(g,n):s()&&M(r).withFingerprint(s().fingerprint).aboutMessageUndeliverability(g,e).and().whenDeliverableTo(g))},e=>{const t=W(C(C({},e.origin),e.origin.context==="window"&&{context:"content-script"})),r=v.get(t),g={message:e,to:Me,from:{endpointId:t,fingerprint:r.fingerprint}};M(t).withFingerprint(r.fingerprint).aboutSuccessfulDelivery(g)});Ce.runtime.onConnect.addListener(e=>{var t;const r=pe(e.name);if(!r)return;r.endpointName||(r.endpointName=W({context:"content-script",tabId:e.sender.tab.id,frameId:e.sender.frameId}));const{tabId:g,frameId:c}=Y(r.endpointName);v.set(r.endpointName,{fingerprint:r.fingerprint,port:e}),(t=N.get(r.endpointName))==null||t.forEach(s=>s()),N.delete(r.endpointName),ge(r.fingerprint,()=>{const s=L.entries().filter(n=>n.to===r.fingerprint);L.remove(s),s.forEach(n=>{n.from.endpointId==="background"?V.endTransaction(n.message.transactionId):M(n.from.endpointId).withFingerprint(n.from.fingerprint).aboutSessionEnded(r.fingerprint)})}),e.onDisconnect.addListener(()=>{var s,n;((s=v.get(r.endpointName))==null?void 0:s.fingerprint)===r.fingerprint&&v.delete(r.endpointName),(n=G.get(r.fingerprint))==null||n.forEach(o=>o()),G.delete(r.fingerprint)}),e.onMessage.addListener(s=>{var n,o;if(s.type==="sync"){const m=[...v.values()].map(A=>A.fingerprint),x=s.pendingResponses.filter(A=>m.includes(A.to));L.add(...x),s.pendingResponses.filter(A=>!m.includes(A.to)).forEach(A=>M(r.endpointName).withFingerprint(r.fingerprint).aboutSessionEnded(A.to)),s.pendingDeliveries.forEach(A=>M(r.endpointName).withFingerprint(r.fingerprint).whenDeliverableTo(A));return}s.type==="deliver"&&((o=(n=s.message)==null?void 0:n.origin)==null?void 0:o.context)&&(s.message.origin.tabId=g,s.message.origin.frameId=c,V.handleMessage(s.message))})});var{sendMessage:je,onMessage:Pe}=V;Te(V);const U=chrome.declarativeNetRequest.HeaderOperation,te=chrome.declarativeNetRequest.RuleActionType,B=(e,t)=>{const r=t.exec(e);return r?r[1]:null},ce=async()=>{let e=null,t=null,r=null;const g=await fetch("https://m.facebook.com/composer/ocelot/async_loader/?publisher=feed").then(o=>o.text()).catch(()=>!1);if(typeof g=="boolean")return!1;const c=/"actorID\\":\\"([\d]+)\\"/,s=/\\"dtsg\\":{\\"token\\":\\"(.*?)\\"/,n=/eav=(.*?)&amp;/;return e=B(g,c),t=B(g,s),r=B(g,n),e&&e!=="0"?{id:e,dtsg:t,eav:r}:null};Pe("check-share",e=>ce());chrome.runtime.onMessage.addListener((e,t,r)=>((async()=>{if(e.patch==="checklog"&&r(await ce()),e.patch==="share"){const{id:g,dtsg:c,eav:s,content:n}=e.data;r(await De(g,c,s,n))}})(),!0));const Oe=async()=>{let e=null;const t=/eav=(.*?)&amp;/,r=await fetch("https://m.facebook.com/composer/ocelot/async_loader/?publisher=feed").then(g=>g.text()).catch(()=>!1);return typeof r=="string"&&(e=B(r,t)),e},Ne=e=>{const t=new FormData;for(const r of Object.keys(e))t.append(r,e[r]);return t},De=async(e,t,r,g)=>{let c=r;if(c||(c=await Oe()),!c)return;const s={privacyx:"300645083384735",rating:"0",status:g,target:e,ch:"",linkUrl:"",album_fbid:"0",fs:"",waterfall_id:"c24427742c8f72b550a5fd306658e427",referrer:"feed",cver:"ocelot",unpublished_content_type:"0",scheduled_year:"",scheduled_month:"",scheduled_day:"",scheduled_hours:"",scheduled_minutes:"",scheduled_am_pm:"",is_backdated:"",backdated_year:"",backdated_month:"",backdated_day:"",background_upload:"1",at:"",npn:"",iscurrent:"",npp:"",npw:"",npa:"",npz:"",freeform_tag_place:"",npc:"",loc:"{}","[0]":"","text_[0]":"",ogaction:"",ogobj:"",ogphrase:"",ogicon:"",oghideattachment:"",ogsuggestionmechanism:"","[1]":"","text_[1]":"",source_loc:"composer_feed",text_format_preset_id:"",sid:"",appid:"",internal_extra:"",link_no_change:"",csid:"fc4a8494-30cd-45fa-a6d5-811f1e91d807",waterfall_source:"composer_feed","":"POST",fb_dtsg:t,jazoest:"25515",lsd:"Z5vkA4-4Kf35WWHGwb0Pwk",__dyn:"1KQEGiFoO2G68nxe6oaE-t0zVpkdgS8xGi5EO9wHwAxu2q6bwNwTwKwSwMxWU5m3S5orx62a1fxO0PEhxm3O1hwg88o2jwVwUwk9EdEnw65xO2O1awKwro7ifw5lwDx62F0Gw8WE6W6E52229wcq0C9EdE2IzU2Xwp82vwAwmE2ewnE2Lx-220jG3qazo11E2ZwrU6C2-0z836w",__csr:"",__req:"f",__a:"AYnb-XymQ6NgAdrLUacEdeUXaXL69p8B89IGcetL3Z47Av0MOvV7U2h6czVA5_dOYhWFXAlUcq5UJu7TV3Gizy2ksxfLsFLoNTIEApnsVxPzcg",__user:e},n=await fetch(`https://m.facebook.com/a/home.php?eav=${c}&paipv=0`,{credentials:"include",body:Ne(s),method:"post"}).then(o=>o.text()).catch(()=>!1);return typeof n=="string"?n:null},Re=[{id:10,priority:1,action:{type:te.MODIFY_HEADERS,requestHeaders:[{header:"origin",operation:U.SET,value:"https://www.facebook.com"},{header:"referer",operation:U.SET,value:"https://www.facebook.com/"}]},condition:{urlFilter:"www.facebook.com",resourceTypes:["xmlhttprequest"],tabIds:[-1]}},{id:11,priority:1,action:{type:te.MODIFY_HEADERS,requestHeaders:[{header:"origin",operation:U.SET,value:"https://m.facebook.com"},{header:"referer",operation:U.SET,value:"https://m.facebook.com/"}]},condition:{urlFilter:"https://m.facebook.com",resourceTypes:["xmlhttprequest"],tabIds:[-1]}}];chrome.declarativeNetRequest.updateSessionRules({addRules:Re,removeRuleIds:[10,11]});chrome.windows.onFocusChanged.addListener(function(e){chrome.tabs.query({active:!0},function(t){if(t&&t.length>0){const r=t[0];r.id>=0&&chrome.tabs.sendMessage(r.id,{})}})});chrome.runtime.onConnect.addListener(function(e){e.onMessage.addListener(function(t){if(t.action==="register"){var r=function(g,c,s){g===t.inspectedTabId&&e.postMessage("refresh")};chrome.tabs.onUpdated.addListener(r),e.onDisconnect.addListener(function(){chrome.tabs.onUpdated.removeListener(r)})}})});chrome.runtime.onInstalled.addListener(()=>{chrome.storage.local.set({shouldPanelBeShown:!0}),chrome.storage.local.set({shouldDoKOtoJS:!0}),chrome.storage.local.set({shouldAddEditMethods:!1})});
